# Backup Configuration for NextJS Stripe Payment Template
# Security-focused backup strategy for payment data

# ============================================================================
# BACKUP RETENTION POLICIES
# ============================================================================

# Logical Backups (pg_dump)
LOGICAL_BACKUP_RETENTION_DAYS=30
LOGICAL_BACKUP_FREQUENCY="0 2 * * *"  # Daily at 2 AM
LOGICAL_BACKUP_COMPRESSION_LEVEL=9

# Physical Backups (pg_basebackup)  
PHYSICAL_BACKUP_RETENTION_DAYS=7
PHYSICAL_BACKUP_FREQUENCY="0 3 * * 0"  # Weekly on Sunday at 3 AM

# WAL Archive Retention
WAL_ARCHIVE_RETENTION_DAYS=14
WAL_ARCHIVE_CLEANUP_FREQUENCY="0 4 * * *"  # Daily at 4 AM

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# Encryption settings (for sensitive payment data)
BACKUP_ENCRYPTION_ENABLED=true
BACKUP_ENCRYPTION_ALGORITHM="AES256"
BACKUP_GPG_RECIPIENT="backup@payment-template.local"

# Access control
BACKUP_USER="backup_user"
BACKUP_GROUP="backup_group"
BACKUP_PERMISSIONS="600"

# ============================================================================
# STORAGE CONFIGURATION
# ============================================================================

# Local storage paths
BACKUP_BASE_PATH="/var/lib/postgresql/backups"
LOGICAL_BACKUP_PATH="$BACKUP_BASE_PATH/logical"
PHYSICAL_BACKUP_PATH="$BACKUP_BASE_PATH/physical"
WAL_ARCHIVE_PATH="$BACKUP_BASE_PATH/wal"
ENCRYPTED_BACKUP_PATH="$BACKUP_BASE_PATH/encrypted"

# Remote storage (for production)
REMOTE_BACKUP_ENABLED=false
REMOTE_BACKUP_TYPE="s3"  # s3, ftp, sftp, rsync
REMOTE_BACKUP_BUCKET="payment-template-backups"
REMOTE_BACKUP_REGION="us-east-1"

# ============================================================================
# VERIFICATION CONFIGURATION
# ============================================================================

# Backup verification settings
VERIFY_BACKUPS=true
VERIFY_FREQUENCY="0 5 * * *"  # Daily at 5 AM
VERIFY_RESTORE_TEST=true
VERIFY_RESTORE_DB="backup_test_db"

# Monitoring settings
BACKUP_MONITORING_ENABLED=true
BACKUP_ALERT_EMAIL="admin@payment-template.local"
BACKUP_SLACK_WEBHOOK=""

# ============================================================================
# DATABASE CONNECTION
# ============================================================================

# Database connection settings for backups
DB_HOST="postgres"
DB_PORT="5432"
DB_NAME="payment_template_dev"
DB_USER="postgres"
DB_PASSWORD_FILE="/var/lib/postgresql/.pgpass"

# Replication user for physical backups
REPLICATION_USER="replica"
REPLICATION_PASSWORD_FILE="/var/lib/postgresql/.replica_pass"

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Backup performance settings
BACKUP_PARALLEL_JOBS=4
BACKUP_CHECKPOINT_TIMEOUT="30min"
WAL_SEGMENT_SIZE="16MB"

# Compression settings
USE_COMPRESSION=true
COMPRESSION_ALGORITHM="gzip"
COMPRESSION_LEVEL=6

# ============================================================================
# POINT-IN-TIME RECOVERY
# ============================================================================

# PITR configuration
PITR_ENABLED=true
ARCHIVE_MODE="on"
ARCHIVE_COMMAND="test ! -f /var/lib/postgresql/backups/wal/%f && cp %p /var/lib/postgresql/backups/wal/%f"
RESTORE_COMMAND="cp /var/lib/postgresql/backups/wal/%f %p"

# Recovery settings
RECOVERY_TARGET_TIME=""
RECOVERY_TARGET_XID=""
RECOVERY_TARGET_NAME=""
RECOVERY_TARGET_LSN=""